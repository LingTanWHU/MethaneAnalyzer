# 气体监测仪数据浏览器

## 项目介绍

气体监测仪数据浏览器是一个基于Python和Streamlit开发的交互式应用程序，用于可视化和分析来自Picarro和Pico气体监测仪的数据。该应用支持多种气体浓度数据的加载、处理、筛选和可视化，包括甲烷(CH4)、二氧化碳(CO2)、水(H2O)和乙烷(C2H6)等。

### 主要功能

- **多数据源支持**：兼容Picarro和Pico两种气体监测仪的数据格式
- **灵活的时间筛选**：支持按日期范围筛选数据，并可切换不同时区
- **数据重采样**：提供多种时间窗口的平均值或中位数聚合（从30秒到1小时）
- **交互式可视化**：使用Plotly生成可交互的气体浓度趋势图
- **数据质量控制**：支持过滤非正数的异常值
- **实时数据缓存**：优化大数据集的加载和处理性能

## 项目结构

```
MethaneAnalyzer/
├── app.py               # 主应用程序
├── run.py               # 启动脚本
├── config/              # 配置模块
│   ├── __init__.py
│   └── settings.py      # 应用配置和常量定义
├── data/                # 数据加载模块
│   ├── __init__.py
│   └── loader.py        # 数据文件加载器
├── processing/          # 数据处理模块
│   ├── __init__.py
│   └── resampler.py     # 数据重采样和处理
├── visualization/       # 可视化模块
│   ├── __init__.py
│   └── plotter.py       # 图表生成器
├── utils/               # 工具模块
│   ├── __init__.py
│   └── helpers.py       # 辅助函数
└── requirements.txt     # 依赖包列表
```

## 安装说明

### 系统要求

- Windows 11 或更高版本
- Python 3.10 或更高版本

### 安装步骤

1. **克隆或下载项目**

2. **安装依赖包**

   ```bash
   pip install -r requirements.txt
   ```

3. **配置数据路径**

   应用默认从环境变量读取数据路径，如果不存在则使用配置文件中的默认路径。可以通过以下两种方式配置：

   - **环境变量方式**（推荐）：
     ```bash
     set PICARRO_DATA_ROOT_PATH=your_picarro_data_path
     set PICO_DATA_ROOT_PATH=your_pico_data_path
     ```

   - **修改配置文件**：编辑 `config/settings.py` 中的默认路径

## 使用方法

### 启动应用

使用以下命令启动应用：

```bash
python run.py
```

或者直接运行：

```bash
python -m streamlit run app.py
```

### 数据浏览和分析

1. **选择数据源**：在侧边栏选择Picarro或Pico数据源

2. **设置时间范围**：选择开始日期和结束日期

3. **选择时区**：默认为UTC+8（上海）

4. **设置数据重采样参数**：
   - 时间窗口：从原始数据到1小时平均
   - 聚合方法：平均值或中位数

5. **数据质量控制**：选择是否过滤非正数的异常值

6. **Picarro数据显示选项**：选择干基浓度或原始浓度（仅Picarro数据源适用）

7. **查看数据可用性**：侧边栏显示所选日期范围内的数据可用性日历

8. **交互式图表操作**：
   - 缩放和平移图表
   - 悬停查看详细数据点
   - 调整Y轴范围

## 数据源要求

### Picarro数据格式

- 数据文件格式：`.dat`文件
- 文件命名：日期时间格式
- 目录结构：`年/月/日/文件名.dat`
- 支持的气体：CH4_dry, CO2_dry, H2O（干基和原始浓度）

### Pico数据格式

- 数据文件格式：`.txt`文件
- 文件命名：`Pico101244_251106_185816.txt` 格式
- 支持的气体：CH4 (ppm), C2H6 (ppb), H2O (ppm)

## 技术栈

- **后端框架**：Python 3.10+, Streamlit
- **数据处理**：pandas, numpy, pytz
- **可视化**：Plotly
- **并发处理**：concurrent.futures, multiprocessing

## 性能优化

- **数据缓存**：使用Streamlit的缓存机制缓存数据加载和处理结果（TTL 5分钟）
- **并行处理**：使用多线程加速多文件数据加载
- **数据筛选**：在加载过程中进行预筛选，减少内存占用

## 注意事项

1. **数据路径配置**：确保正确配置了Picarro和Pico的数据路径
2. **时区设置**：数据时间默认以UTC存储，显示时转换为用户选择的时区
3. **内存使用**：处理大量历史数据时可能需要更多内存
4. **H2O单位转换**：对于Picarro数据，H2O浓度会自动从%转换为ppm

## 许可证

[MIT](LICENSE)

## 维护与支持

如有任何问题或建议，请联系项目维护人员。